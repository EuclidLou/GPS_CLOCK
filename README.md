# GPS_CLOCK

## GPS授时的迷你时钟
![](/IMG/1.jpg)
## 前言
这是基地招新题目，怎么算成本都要100-200，不如做一个好看点的 <br>
板子的电池接口在两侧，之后会用弹簧连接电池仓 <br>


## 项目结构
|目录|内容|
|---|----|
|PCB_RELEASE|PCB|
|SOFTWARE|程序|
|CAD|外壳|

## 硬件部分
![](/IMG/2.jpg)
主控依然使用ESP32-C3，GPS选用GP-02模块，数码管选了很久，找到了一家专门做贴片数码管的 <br>
译码器使用经典74HC595，担心输出功率不够，加了一级PMOS驱动 <br>
电源管理用的外置TYPE-C供电或一节18650，自动切换电源，并在外接电源时充电 <br>
按键从侧面引出四个，其中三个是可编程的，同时也是BOOT时的STRAPPER引脚(boot选择会自动锁存STRAPPER的值，因此可以复用) <br>
烧录方式通过ESP32内置的USB-JTAG桥，背面也留出了UART0的TEST POINT
![](/IMG/3.jpg)

## 软件部分
依然通过IDF编写，基于FreeRTOS建立3个线程 <br>
|Thread|Function|
|------|--------|
|TaskA |显示时间|
|TaskB |校准时间|
|TaskC |菜单管理|

校准时间通过读取GP-02的 $GNZDA 字段，截取相应时间和日期 <br> 
实测室内冷启动校准耗时30s，热启动4s <br>
菜单正在完善，目前一级菜单KEY0切换显示 时间/日期 ，KEY1、KEY2调整亮度 <br>

## 机械部分
大致设计了一个外壳，把电池座和陶瓷天线都装进去 <br>
![](/IMG/4.jpg)
![](/IMG/6.jpg)
![](/IMG/5.jpg)
外壳思路很美好，实际很拉跨，厚度小于宽度和长度，加上学校3D打印机粗糙的精度，极不符合人类审美，后续可能会改用较薄的锂电芯，并用亚克力板雕刻前后壳，形成三明治结构(或者没有后续，，)。

## 其他
### 关于LDO
ldo部分设计有错误，本来以为rt9193自带输出二极管，实际没有，故不可直接并联 <br>
单个9193可以提供300mA输出，不使用ESP32自带的射频则只需一只ldo
### 关于功耗
整机运行电流(bat端)为70mA左右，其中GPS为40mA，如果接受对时冷启动，满亮度常规运行功耗为30mA。使用18650(5000mAh)可待机约一周。
